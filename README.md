Решение задачи для олимпиады ЦПМ 2019 года.

## Disclaimer
Задача тестировалась в основном на симуляторе.
Под конкретную карту её потребуется подгонять.
В реальности, как рассказали опытные бойцы, может быть много чудес:
* подсевшие аккумуляторы, которые дают непредсказуемое поведение серво-приводов;
* датчики цвета, которые зелёный могут принимать за чёрный, и за белый в зависимости от настроения;
* движки с дефектами, где два одинаковых двигателя могут при одинаковых значениях проезжать разное расстояние;
* бликующее поле, которе может существенно искажать показания датчиков;
* и многое другое.

## Задача
Полное описание задачи есть в каталоге `docs`.
Вкратце, на поле нарисован штрих-код и есть координатная сетка.
Робот должен считать записанное в штрих-коде двузначное число, являющееся координатой.
Далее робот должен доехать до указанной координаты, зафиксировать остановку и вернуться домой.
Есть ещё задача найти оптимальный путь с минимальной стоимостью, но мне уже было лень её решать.

## Решение
Решать задачу нужно было с помощью набора Lego Mindstorms EV3 и их одноимённой среды разработки.
Чтобы упростить задачу я собрал поле для отладки в [VirtualRoboticsToolkit](https://www.virtualroboticstoolkit.com/).

## История
Сын участвовал в олимпиаде, я естественно с интересом следил за его подготовкой и старался не вмешиваться.
Меня удивило, что такая, вроде примитивная задача, заняла столько времени на реализацию.
Я решил попробовать решить её сам ...

## Выводы
Провозившись часов семь со средой Mindstorms, изучая её особенности и борясь с глюками, я понял куда уходит время.
Ниже мои выводы о том, что стоит/не стоит делать, работая с этой средой (далее SDK):
* SDK глючит, может вылететь в любой момент. Делайте сейвы чаще.
* Рядом нехитрых манипуляций можно добиться того, что проект не будет открываться вообще. Сохраняйте бэкапы, пользуйтесь контроллем версий.
* Блоки прыгают непредсказуемо, при добавлении нового могут рандомно рваться связи. Бейте программу на подпрограммы.
* Среда начинает лагать, если в программе на экране больше 20 блоков. Бейте программу на подпрограммы.
* Отсутствуют средства отладки. Делайте хэлперы для вывода отладочной информации на экран девайса. Делайте небольшие блоки, меньше блок -- меньше возни с отладкой
* Тестирование стоит дорого (нужно отнести робота на поле, дождаться выполнения).
Разбивайте программу на модули, тестируйте каждый в отдельности.
Например, в этой проге легко выделяются модули поиска границы, чтения штрих-кода, езды по координате, возвращения домой, которые можно тестировать независимо.
Загружайте сразу несколько модулей в блок (они будут отображаться как отдельные подпрограммы), чтобы можно было за один поход к полю протестить несколько вещей.
Используйте симулятор, он конечно не до конца отражает реальность, но всё-равно экономит много времени.
* По умолчанию блоки выстраиваются в одну линию, и на экране видно 5-10 блоков за раз, горизонтальный скролл тормозит, что осложняет чтение программы.
Располагайте блоки в несколько строк, каждую строку старайтесь делать не шире экрана.
Это не всегда адекватно работает при добавлении нового блока, но если в каждой подпрограмме 10-15 блоков, то проблемы не вызывает.
При этом вертикальный скролл работает быстро и хорошо, поэтому просматривать программу становится существенно проще.
* Очень много действий мышкой нужно делать ради элементарного результата. Пользуйтесь [шорткатами](https://ev3-help-online.api.education.lego.com/Education/en-gb/page.html?Path=editor%2FKeyboardShortcuts.html), их не много, но лучше чем ничего.
* Нет контроля версий. Проект -- это zip архив с xml-никами, тут ничего кроме сохранения бэкапов раз в N минут не придумаешь.

## Финальный вывод
В среде Lego Mindstorms можно учить детей только в самом начале, когда им ещё тяжело следить за скобками и точками-запятыми.
Тут можно делать простенькие программы, чтобы заинтересовать детей.
Что-то более-менее серьёзное вызывает вытекание глаз, фрустрацию и раздражение.
Работать эффективно в этой среде просто нельзя (придумать алгоритм у меня заняло 30-40 мин, реализовать -- около 7 часов).
Сейчас ребёнок изучает Robot-C, там можно на человеческом C писать программы для EV3.
Возможно будет продолжение...
